const e=e=>new Promise((t,s)=>{setTimeout(()=>s(Error("Request timed out. Please try again later...")),1e3*e)}),t=async(t,s,r=null,a)=>{let o;if("profile"===a){let e=new FormData;for(let t in r)e.append(t,r[t]);o={method:s,body:e}}else o={method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)};try{let s=r?fetch(t,{...o}):fetch(t),a=await Promise.race([s,e(5)]),n=await a.json();if(!a.ok)throw Error(n.message);return n}catch(e){throw"Failed to fetch"===e.message&&(e.message="Unable to reach the server. Please check your internet connection..."),e}},s=()=>{let e=document.querySelector(".alert");e&&e.parentElement.removeChild(e)},r=(e,t,r=4)=>{s();let a=`<div class="alert alert--${e}">${t}</div>`;document.querySelector("body").insertAdjacentHTML("afterbegin",a),window.setTimeout(s,1e3*r)},a=async e=>{try{let s=await t("/api/v1/users/signup","POST",e);if("success"===s.status&&(r("success","Your account on Natours is ready ! login and Start the Adventures"),setTimeout(()=>location.assign("/"),1500)),"success"!==s.status)return}catch(e){r("error",e.message)}},o=async(e,s)=>{try{let r=await t("/api/v1/users/login","POST",{email:e,password:s});if("success"===r.status&&setTimeout(()=>window.location.replace("/"),200),"success"!==r.status)return}catch(e){r("error",e.message)}},n=async()=>{try{let e=await t("/api/v1/users/logout","GET");"success"===e.status&&setTimeout(()=>window.location.assign("/"),1e3)}catch(e){r("error","Error has occurred while logging out, try again")}},u=async(e,s)=>{try{let a="password"===s?"updateMyPassword":"updateMyData",o=await t(`/api/v1/users/${a}`,"PATCH",e,s);"success"===o.status&&r("success",`Your ${s}'s been updated successfully !â™¥`)}catch(e){r("error",e.message)}},c=async e=>{try{let s=await t(`/api/v1/bookings/checkout/${e}`,"POST",{tourId:e});"success"===s.status&&(r("success","Your've booked one tour successfully"),setTimeout(()=>location.assign("/myBookings"),1500))}catch(e){r("error",e.message)}},i=document.querySelector(".form--signup");i&&i.addEventListener("submit",e=>{console.log("formSignup eventListener INSIDER"),e.preventDefault(),document.querySelector(".btn--form-signup").textContent="Processing...";let t=e.target.username.value,s=e.target.email.value,r=e.target.password.value,o=e.target.passwordConfirm.value;a({name:t,email:s,password:r,passwordConfirm:o}),i.reset()});const l=document.querySelector(".form--login");l&&l.addEventListener("submit",e=>{e.preventDefault();let t=e.target.email?.value,s=e.target.password?.value;o(t,s),l.reset()});const d=document.querySelector(".nav__el--logout");d&&d.addEventListener("click",n);const m=document.querySelector(".form-user-data");m&&m.addEventListener("submit",e=>{e.preventDefault(),document.querySelector(".btn--save-settings").textContent="Updating...";let t=e.target.name?.value,s=e.target.email?.value,r=e.target.photo?.files[0];u({name:t,email:s,photo:r},"profile"),m.reset(),setTimeout(()=>location.reload(),1e3)});const g=document.querySelector(".form-user-password");g&&g.addEventListener("submit",async e=>{e.preventDefault(),document.querySelector(".btn--save-password").textContent="Updating...";let t=document.getElementById("password-current").value,s=document.getElementById("password-new").value,r=document.getElementById("password-confirm").value;await u({currentPassword:t,newPassword:s,confirmNewPassword:r},"password"),g.reset(),document.querySelector(".btn--save-password").textContent="Save Password"});const p=document.getElementById("book-tour");p&&p.addEventListener("click",e=>{p.textContent="Processing...";let{tourId:t}=e.target.dataset;c(t)});
//# sourceMappingURL=index.js.map
